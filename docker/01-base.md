# Docker

## Dockerfile
### FROM
Этой строкой указывается образ - OS + набор заранее установленных инструментов. Пример:

`FROM ubuntu:22.04 AS builder`

В общем виде строка выглядит так:

`FROM image[:tag] [AS nickname]`

### WORKDIR
По-умолчанию в docker image мы находимся в директории `/`. Чтобы ее поменять используется комманда `WORKDIR`. Пример

```Dockerfile
WORKDIR  /home/inv/
```

Фактически это то же самое, что и
```bash
mkdir -p DIR && cd_permanently DIR
```

### RUN, and others
Эта комманда будет выполняться **во время воздания контейнера**, например, можно попросить установить что-то нужное в дальнейшем:

```Dockerfile
RUN apt-get update && apt-get install -y curl
```

Помимо `RUN` есть также возможность некоторые комманды вызвать более красивым способом. Например, 
```Dockerfile
ENV DMD_VERSION=2.110.0
ENV PATH="/co/lon/fal/ling/in/to/pants:${PATH}"
```

### COPY
Для того, чтобы добавить файлы проекта с компьютера, на котором происходила разработка в контейнер, можно использовать `COPY`. Указываются 2 путя: первый - путь на хосте, второй - путь внутри контейнера (относительно конечно `WORKDIR`). Обычно эта комманда используется без лишних рукоплесканий, как

```Dockerfile
COPY . .
```

### CMD
Комманда bash которая будет выполнена при запуске контейнера. Ничего не делает на момент создания контейнера. Точно также, как все остальные комманды `Dockerfile` ничего не делают на момент запуска.
```Dockerfile
CMD ["./exe_of_programm"]
```

## Некоторая информация
### Daemon
Для работы докеру нужен демон. На windows этого демона можно поднять открыв docker desktop (поднимется он, вроде бы, на WSL все равно). На linux наверное тоже, либо `systemclt start dockerd` или даже как-то проще.

Для проверки запущености демона, следует написать `docker run hello-world`

### Слои
Все комманды докера (описанные выше) - это слои. Каждая следующая комманда - это следующий слой после предыдущего. Это позволяет кэшировать шаги создания контейнера. Засчет этого, при пересборке, никакой шаг до шага, на котором должны быть изменения, выполняться не будет.

## CLI
Базовые комманды докера.
```bash
docker build -t container dir
docker run container
# redirect port in container to port on host:
docker run -p 8080:8080 container
docker ps -a
docker rmi image
docker stop container
docker image
docker rmi $(docker images)
...
```

